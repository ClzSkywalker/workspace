FROM ubuntu:24.10

# 宿主机ip
ENV PC_HOST 0.0.0.0 
# ubuntu root 密码
ENV PWD root

WORKDIR /root
RUN cd /root/

RUN cp /etc/apt/sources.list /etc/apt/sources.list.bak
RUN sed -i 's/archive.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list

RUN apt-get update && apt-get install -y locales && rm -rf /var/lib/apt/lists/* \
    && localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8

ENV LANG en_US.utf8

RUN apt-get update && apt-get install -y \
    bash \
    build-essential \
    gcc-multilib \
    curl \
    git \
    vim \
    wget \
    snapd \
    tzdata \
    cmake \
    neovim \
    # 压缩包工具
    zip \
    tar \
    p7zip-full \
    # python环境
    python3 \
    python3-pip \
    # 搜索工具
    ripgrep \
    fish \
    pkg-config \
    libssl-dev \
    # golang
    golang-go \
    # protobuf 工具
    protobuf-compiler \
    libprotobuf-dev \
    # bevy 配置
    g++ \
    libx11-dev \
    libasound2-dev \
    libudev-dev \
    lld \
    # 网络工具
    openssh-server \
    net-tools \
    && rm -rf /var/lib/apt/lists/*

# rust
RUN echo 'export RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static' >> /root/.bashrc
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs > rustup.sh
RUN chmod +x rustup.sh
RUN sh ./rustup.sh -y
# 安装 protobuf lsp 
RUN /opt/go/bin/go install github.com/bufbuild/buf-language-server/cmd/bufls@latest
# 安装lazygit
RUN /opt/go/bin/go install github.com/jesseduffield/lazygit@latest


# 安装node https://deb.nodesource.com/
RUN curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg
# RUN NODE_MAJOR=20
RUN echo "deb [signed-by=/etc/apt/keyrings/nodesource.gpg] https://deb.nodesource.com/node_20.x nodistro main" |  tee /etc/apt/sources.list.d/nodesource.list
RUN apt-get update 
RUN apt-get install nodejs -y
RUN npm config set registry https://registry.npm.taobao.org
RUN npm install -g npm@10.1.0
# 文件搜索
RUN npm install -g -y fd-find 
# json格式化
# RUN npm install -y --save-dev --save-exact prettier

# 下载nvim配置以及依赖包
RUN git clone https://github.com/ClzSkywalker/starter.git /root/.config/nvim

# 设置ssh网络
RUN echo "Port 22" >> /etc/ssh/sshd_config
RUN echo "PermitRootLogin yes" >> /etc/ssh/sshd_config

CMD ["/bin/sh"]